global_defs {
}

vrrp_script chk_haproxy {
  script "killall -0 haproxy"
  interval 1
  weight 2
  fall 2
  rise 1
}

vrrp_instance VI_1 {
    interface eth0
    virtual_router_id 51
    state MASTER
    priority 101
    advert_int 1
    unicast_src_ip {{ ansible_default_ipv4.address }}
    unicast_peer {
      {% for peer in haproxy_keepalived_peers %}
      {{ peer }}
      {% endfor %}
    }
    authentication {
      auth_type PASS
      auth_pass Kls45f3d
    }
    virtual_ipaddress {
      {% for vip in haproxy_keepalived_virtual_ips %}
      {{ vip }}
      {% endfor %}
    }
    track_script {
      chk_haproxy
    }
}